---
layout:     post
title:      关于NSString的内存地址
subtitle:   NSCFConstantString、NSTaggedPointerString、NSCFString
date:       2021/11/09
author:     HongWeiChen
header-img: img/blog-banner-dark.jpg
catalog: true
tags:
    - Objective-C
---

# 前言

同事因为这几天一直在学习Objective-C相关的基础知识，碰到一些问题探讨了一下，其中NSString的探讨比较有趣，也很久没有复习基础知识了，记录一下。

# NSString的内存

我们都知道，在创建NSString的时候，通过控制台可以观察到NSString不同的创建方式会产生几种不同的类型

- NSCFConstantString，存储于常量区，MRC下无需手动释放，也无法释放。
- NSTaggedPointerString，指针就是字符串的值，所以应该是存储于栈中，但是不会被释放，retainCount是无限大的。
- NSCFString，存储于堆中，MRC下需要手动释放。

关于NSTaggedPointerString，一开始我也不是很理解这个东西，觉得是存储于常量区，因为他同样不会被释放，但是参考了一些资料之后，认为他是存储于栈中的，我们知道指针是存储于栈中由系统进行管理的，而NSTaggedPointerString本身就是一个指针，而指针本身内存地址本身就存储了String的值，所以它应该是存储于栈中的。
- [NSTaggedPointerString参考资料 来自知乎](https://zhuanlan.zhihu.com/p/201443317)

我们通过`NSString *str = @"Hello world"`基本都是通过NSCFConstantString来创建的，他会直接存储于常量区，哪怕我在创建一个新的字符串变量`NSString *str2 = @"Hello world"`他仍然会指向同一个指针地址。

```
NSString *str = @"Hello world";
NSString *str2 = @"Hello world";
NSLog(@"%p", str);
NSLog(@"%p", str2);

2021-11-15 12:08:01.595187+0800 Test[69527:1679878] 0x10e0620b8
2021-11-15 12:08:12.793815+0800 Test[69527:1679878] 0x10e0620b8
```
